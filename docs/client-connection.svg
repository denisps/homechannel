<svg width="700" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- Components -->
  <text x="40" y="20" font-family="monospace" font-size="14" font-weight="bold">App Page</text>
  <line x1="80" y1="30" x2="80" y2="780" stroke="#333" stroke-width="2" />
  
  <text x="195" y="20" font-family="monospace" font-size="14" font-weight="bold">Iframe</text>
  <line x1="220" y1="30" x2="220" y2="780" stroke="#333" stroke-width="2" />
  
  <text x="330" y="20" font-family="monospace" font-size="14" font-weight="bold">Coordinator</text>
  <line x1="380" y1="30" x2="380" y2="780" stroke="#333" stroke-width="2" />
  
  <text x="550" y="20" font-family="monospace" font-size="14" font-weight="bold">Server</text>
  <line x1="580" y1="30" x2="580" y2="780" stroke="#333" stroke-width="2" />
  
  <!-- Create iframe -->
  <line x1="80" y1="50" x2="220" y2="50" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="110" y="45" font-family="monospace" font-size="11" fill="#333">create</text>
  <text x="620" y="50" font-family="monospace" font-size="10" fill="#0066cc">(iframe visible)</text>
  
  <!-- Request -->
  <line x1="80" y1="70" x2="220" y2="70" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="110" y="65" font-family="monospace" font-size="11" fill="#333">request</text>
  
  <!-- Get challenge -->
  <line x1="220" y1="90" x2="380" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="250" y="85" font-family="monospace" font-size="11" fill="#333">get ch</text>
  
  <line x1="380" y1="110" x2="220" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Captcha/Ads -->
  <text x="220" y="135" font-family="monospace" font-size="11" fill="#0066cc" text-anchor="middle">[captcha]</text>
  <text x="220" y="155" font-family="monospace" font-size="11" fill="#0066cc" text-anchor="middle">[ads]</text>
  
  <!-- PostMessage -->
  <line x1="220" y1="175" x2="80" y2="175" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="120" y="170" font-family="monospace" font-size="11" fill="#333">postMsg</text>
  
  <!-- App processing -->
  <text x="10" y="210" font-family="monospace" font-size="11" fill="#0066cc">Verify server key</text>
  <text x="10" y="230" font-family="monospace" font-size="11" fill="#0066cc">Prompt password</text>
  <text x="10" y="250" font-family="monospace" font-size="11" fill="#0066cc">Compute answer</text>
  <text x="10" y="270" font-family="monospace" font-size="11" fill="#0066cc">Gather ICE</text>
  
  <!-- Send offer -->
  <line x1="80" y1="300" x2="220" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="115" y="295" font-family="monospace" font-size="11" fill="#333">send</text>
  
  <line x1="220" y1="320" x2="380" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="240" y="315" font-family="monospace" font-size="11" fill="#333">offer+ans</text>
  
  <text x="400" y="340" font-family="monospace" font-size="11" fill="#0066cc">Verify answer</text>
  
  <!-- Relay to server -->
  <line x1="380" y1="360" x2="580" y2="360" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="430" y="355" font-family="monospace" font-size="11" fill="#333">relay (AES)</text>
  
  <!-- Server processing -->
  <text x="600" y="380" font-family="monospace" font-size="11" fill="#0066cc">Gather ICE</text>
  <text x="600" y="400" font-family="monospace" font-size="11" fill="#0066cc">Create answer</text>
  
  <!-- Answer back -->
  <line x1="580" y1="420" x2="380" y2="420" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="430" y="415" font-family="monospace" font-size="11" fill="#333">answer (AES)</text>
  
  <line x1="380" y1="440" x2="220" y2="440" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <line x1="220" y1="460" x2="80" y2="460" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="120" y="455" font-family="monospace" font-size="11" fill="#333">postMsg</text>
  
  <!-- WebRTC Datachannel -->
  <line x1="80" y1="500" x2="580" y2="500" stroke="#009900" stroke-width="3" stroke-dasharray="5,5" />
  <text x="250" y="495" font-family="monospace" font-size="12" font-weight="bold" fill="#009900">WebRTC Datachannel</text>
  
  <!-- Delete iframe -->
  <line x1="80" y1="530" x2="220" y2="530" stroke="#cc0000" stroke-width="2" />
  <text x="110" y="525" font-family="monospace" font-size="11" fill="#cc0000">delete</text>
  <circle cx="220" cy="530" r="8" fill="none" stroke="#cc0000" stroke-width="2" />
  <line x1="215" y1="525" x2="225" y2="535" stroke="#cc0000" stroke-width="2" />
  <line x1="225" y1="525" x2="215" y2="535" stroke="#cc0000" stroke-width="2" />
  <text x="240" y="535" font-family="monospace" font-size="10" fill="#0066cc">(iframe removed)</text>
  
  <!-- Direct communication -->
  <line x1="80" y1="570" x2="580" y2="570" stroke="#009900" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="240" y="565" font-family="monospace" font-size="11" fill="#009900">Direct Communication</text>
  
  <!-- Connection breaks -->
  <text x="250" y="610" font-family="monospace" font-size="11" fill="#cc6600">[connection breaks]</text>
  
  <!-- Recreate iframe -->
  <line x1="80" y1="640" x2="220" y2="640" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="105" y="635" font-family="monospace" font-size="11" fill="#333">recreate</text>
  <text x="240" y="645" font-family="monospace" font-size="10" fill="#0066cc">(iframe recreated)</text>
  
  <line x1="80" y1="660" x2="220" y2="660" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="110" y="655" font-family="monospace" font-size="11" fill="#333">request</text>
  
  <line x1="220" y1="680" x2="380" y2="680" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="250" y="675" font-family="monospace" font-size="11" fill="#333">reconnect</text>
  
  <!-- Repeat flow -->
  <text x="250" y="720" font-family="monospace" font-size="11" fill="#0066cc">(repeat flow)</text>
  <circle cx="220" cy="740" r="3" fill="#0066cc" />
  <circle cx="240" cy="740" r="3" fill="#0066cc" />
  <circle cx="260" cy="740" r="3" fill="#0066cc" />
</svg>
